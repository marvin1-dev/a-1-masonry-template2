<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="A-1 Masonry offers expert construction and maintenance solutions." />
  <meta name="keywords" content="Construction, Masonry, Maintenance, Safety, Consultation" />
  <meta name="author" content="A-1 Masonry" />
  <title>A-1 Masonry | Expert Construction & Maintenance Services</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<header>
  <h1>A-1 Masonry</h1>
  <nav>
    <a href="#services">Services</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
    <a href="#book" class="btn">Book now</a>
  </nav>
</header>

<section class="hero">
  <div class="hero-content">
    <h2>Expert Construction and Maintenance Solutions</h2>
  </div>
</section>

<section class="section" id="products">
  <div class="container">
    <h3>Featured Products</h3>
    <div class="card-container">
      <div class="card circle">
        <img src="https://picsum.photos/300/300?random=1" alt="Precision Build Services">
        <h4>Precision Build Services</h4>
        <p>$25</p>
      </div>
      <div class="card circle">
        <img src="https://picsum.photos/300/300?random=2" alt="24/7 Support Hub">
        <h4>24/7 Support Hub</h4>
        <p>$25</p>
      </div>
      <div class="card circle">
        <img src="https://picsum.photos/300/300?random=3" alt="SafeGuard Pro">
        <h4>SafeGuard Pro</h4>
        <p>$25</p>
      </div>
    </div>
    <div class="btn-wrapper">
      <a href="#services" class="btn">Shop All</a>
    </div>
  </div>
</section>

<section class="section" id="services">
  <div class="container">
    <h3>Our Services</h3>
    <div class="card-container">
      <div class="card">
        <img src="https://picsum.photos/600/400?random=4" alt="Precision Build Solutions">
        <h4>Precision Build Solutions</h4>
        <p>$99</p>
        <p>Delivering top-tier construction management and maintenance services.</p>
      </div>
      <div class="card">
        <img src="https://picsum.photos/600/400?random=5" alt="Expert Consultation">
        <h4>Expert Consultation</h4>
        <p>$149</p>
        <p>Personalized guidance and innovative solutions.</p>
      </div>
      <div class="card">
        <img src="https://picsum.photos/600/400?random=6" alt="Secure Build Compliance">
        <h4>Secure Build Compliance</h4>
        <p>$199</p>
        <p>Ensuring every project meets stringent safety standards.</p>
      </div>
    </div>
    <a href="#book" class="btn">Schedule Your Appointment</a>
  </div>
</section>

<section class="section" id="book">
  <div class="container two-column">
    <div class="column-left">
      <h3>Schedule your appointment</h3>
      <p>
        Scheduling an appointment with our team ensures expert guidance tailored to your project’s needs.
      </p>
      <img src="https://picsum.photos/600/600?random=7" alt="Schedule Appointment">
    </div>

    <div class="column-right">

      <!-- STEP 1: SELECT SERVICE -->
      <div class="booking-step step-1">
        <h4>Select Service</h4>
        <div class="service-card">
          <div><strong>Free Consultation</strong><br><small>30 minutes</small></div>
          <button class="book-btn" data-service="Free Consultation">Book</button>
        </div>
        <div class="service-card">
          <div><strong>Basic Service</strong><br><small>1 hour @ $99.00</small></div>
          <button class="book-btn" data-service="Basic Service">Book</button>
        </div>
        <div class="service-card">
          <div><strong>Advanced Service</strong><br><small>1 hour @ $199.00</small></div>
          <button class="book-btn" data-service="Advanced Service">Book</button>
        </div>
      </div>

      <!-- STEP 2: ENTER NAME + EMAIL -->
      <div class="booking-step step-2" style="display:none;">
        <button class="back-btn">←</button>
        <h4>Enter Your Info</h4>
        <form id="checkForm">
          <input type="hidden" name="service" id="step2_service">

          <label for="name">Full Name</label>
          <input type="text" id="step2_name" name="name" required>

          <label for="email">Email Address</label>
          <input type="email" id="step2_email" name="email" required>

          <button type="submit">Continue</button>
        </form>
        <div id="checkResult"></div>
      </div>

      <!-- STEP 3: SHOW CURRENT BOOKINGS -->

        <div class="booking-step step-3" style="display:none;">
        <button id="backToStep2" class="back-btn">←</button>
        <h4>Your Current Bookings</h4>
        <div id="currentBookings">Loading...</div>
        <button id="bookAnotherFrom3" class="btn" style="margin-top:1rem;">Book Another Appointment</button>
        </div>


      <!-- STEP 4: PICK DATE + TIME -->
<!-- STEP 4: PICK DATE + TIME -->
        <div class="booking-step step-4" style="display:none;">
        
        <button class="back-btn">←</button>
        <h4>Date & Time</h4>

        <div id="calendarLoading" class="loading-spinner" style="display:none;">
            <div class="spinner"></div>
            <p>Loading available dates...</p>
        </div>


        <!-- Then your service-summary and rest -->
        <div class="service-summary">Service: <span id="step4_service">...</span></div>
        <div class="toggle-view">
        <label class="switch">
            <input type="checkbox" id="toggleCustomDateSwitch">
            <span class="slider round"></span>
        </label>
        <span id="toggleLabel">Or Choose Custom Date</span>
        </div>

        <div class="date-nav">
            <button id="prevWeek">←</button>
            <div id="calendarWeek" class="week-dates"></div>
            <button id="nextWeek">→</button>
        </div>

        <div class="custom-date">
            <label for="customDate">Pick another date:</label>
            <input type="date" id="customDate">
        </div>

        <div class="time-slots" id="timeSlots">
            <p>Please select a date</p>
        </div>

        <form id="bookingForm">
            <input type="hidden" name="service" id="selectedService">
            <input type="hidden" name="date" id="selectedDate">
            <input type="hidden" name="time" id="selectedTime">
            <input type="hidden" name="name" id="selectedName">
            <input type="hidden" name="email" id="selectedEmail">

            <button type="submit" id="confirmBookingBtn" disabled>Confirm Booking</button>

        </form>

        <div id="bookingResult"></div>
        </div>


      <!-- STEP 5: THANK YOU -->
      <div class="booking-step step-5" style="display:none; text-align:center;">
        <img src="./imgs/logo-transparent-svg.svg" alt="A-1 Masonry" style="max-width:150px; margin-bottom:1rem;">
        <h3>Thank you!</h3>
        <p>Your appointment has been confirmed.<br>We will be in touch with you shortly.</p>
        <button id="bookAnotherFrom5" class="btn" style="margin-top:1.5rem;">Book Another Appointment</button>
      </div>

    </div>
  </div>
</section>





<section class="section two-column" id="about">
  <div class="container">
    <div class="column-img">
      <img src="https://picsum.photos/600/600?random=8" alt="About our company">
    </div>
    <div class="column-text">
      <h3>About our company</h3>
      <p>We pride ourselves on delivering top-tier solutions with unmatched precision and reliability.</p>
      <a href="#contact" class="btn">Learn More</a>
    </div>
  </div>
</section>

<section class="section two-column" id="contact">
  <div class="container">
    <div class="column-text">
      <h3>Contact Us</h3>
      <p>Interested in working together? Fill out some info and we will be in touch shortly.</p>
      <form id="contactForm">
        <label for="firstName">First Name</label>
        <input type="text" id="firstName" name="firstName" required />

        <label for="lastName">Last Name</label>
        <input type="text" id="lastName" name="lastName" />

        <label for="email">Email</label>
        <input type="email" id="email" name="email" required />

        <label for="message">Message</label>
        <textarea id="message" name="message" rows="5" required></textarea>

        <button type="submit">Send</button>
      </form>
    </div>
  </div>
</section>

<footer>
  <div class="container footer-grid">
    <div>
      <p>Your Site Title</p>
      <p>Made with <a href="https://www.squarespace.com">Squarespace</a></p>
    </div>
    <div>
      <p>Location<br>123 Demo Street<br>New York, NY 12345</p>
    </div>
    <div>
      <p>Contact<br>email@example.com<br>(555) 555-5555</p>
    </div>
  </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {

const AVAILABLE_API = 'https://6p764d9nkl.execute-api.us-east-1.amazonaws.com/default/A1Available-dates';
const BOOKING_API = 'https://de4igqskmj.execute-api.us-east-1.amazonaws.com/default/A1Book';
const LOOKUP_API = 'https://de4igqskmj.execute-api.us-east-1.amazonaws.com/default/A1Book';

let currentWeekStart = new Date();
let availableDatesGlobal = [];

function formatDate(dateObj) {
  return dateObj.toISOString().split('T')[0];
}

function getWeekDates(start) {
  const week = [];
  for (let i = 0; i < 7; i++) {
    const d = new Date(start);
    d.setDate(start.getDate() + i);
    week.push(d);
  }
  return week;
}

async function loadAvailableDates(service) {
  try {
    const response = await fetch(`${AVAILABLE_API}?service=${encodeURIComponent(service)}`);
    const data = await response.json();
    availableDatesGlobal = data.available_dates || [];
    return availableDatesGlobal;
  } catch (err) {
    console.error('Failed to load dates:', err);
    availableDatesGlobal = [];
    return [];
  }
}

function renderWeek(availableDates) {
  const week = getWeekDates(currentWeekStart);
  const calendarWeek = document.getElementById('calendarWeek');
  calendarWeek.innerHTML = '';

  week.forEach(dateObj => {
    const dateStr = formatDate(dateObj);
    const slots = availableDates.find(d => d.date === dateStr)?.slots || [];

    const dayCard = document.createElement('div');
    dayCard.className = 'day-card';
    dayCard.innerHTML = `
      <div>${dateObj.toLocaleDateString('en-US', { weekday: 'short' })}</div>
      <div>${dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
    `;

    dayCard.addEventListener('click', () => {
      document.getElementById('selectedDate').value = dateStr;
      document.querySelectorAll('.day-card').forEach(el => el.classList.remove('selected'));
      dayCard.classList.add('selected');

      renderTimeSlots(slots);
      updateConfirmButtonState();
    });

    calendarWeek.appendChild(dayCard);
  });
}

function renderTimeSlots(slots) {
  const timeSlots = document.getElementById('timeSlots');
  timeSlots.innerHTML = '';

  if (slots.length > 0) {
    slots.forEach(time => {
      const btn = document.createElement('button');
      btn.className = 'slot';
      btn.textContent = time;
      btn.addEventListener('click', () => {
        document.getElementById('selectedTime').value = time;
        document.querySelectorAll('.slot').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        updateConfirmButtonState();
      });
      timeSlots.appendChild(btn);
    });
  } else {
    timeSlots.innerHTML = '<p style="text-align:center;">No appointments available</p>';
    document.getElementById('selectedTime').value = '';
    updateConfirmButtonState();
  }
}

function showStep(stepClass) {
  document.querySelectorAll('.booking-step').forEach(step => {
    step.style.display = 'none';
    step.classList.remove('active');
  });
  const stepElement = document.querySelector(stepClass);
  if (stepElement) {
    stepElement.style.display = 'flex';
    setTimeout(() => stepElement.classList.add('active'), 10);
  }
}

document.querySelectorAll('.book-btn').forEach(button => {
  button.addEventListener('click', function() {
    const service = this.getAttribute('data-service');
    document.getElementById('step2_service').value = service;
    showStep('.step-2');
  });
});

document.getElementById('checkForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const service = document.getElementById('step2_service').value;
  const name = document.getElementById('step2_name').value;
  const email = document.getElementById('step2_email').value;

  document.getElementById('selectedService').value = service;
  document.getElementById('selectedName').value = name;
  document.getElementById('selectedEmail').value = email;

  try {
    const response = await fetch(LOOKUP_API, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        action: 'lookup',
        service,
        name,
        email
      })
    });

    const result = await response.json();

    if (result.bookings && result.bookings.length > 0) {
      showStep('.step-3');

      const bookingsDiv = document.getElementById('currentBookings');
      bookingsDiv.innerHTML = '';
      result.bookings.forEach(b => {
        const item = document.createElement('div');
        item.className = 'booking-card';

        const formattedDate = new Date(b.date).toLocaleDateString('en-US', {
          month: '2-digit',
          day: '2-digit',
          year: 'numeric'
        });

        item.innerHTML = `
          <h5>${b.service}</h5>
          <p>${formattedDate} at ${b.time}</p>
          <button class="edit-booking-btn"
            data-service="${b.service}" 
            data-date="${b.date}" 
            data-time="${b.time}" 
            data-email="${email}">
            Edit
          </button>
        `;

        bookingsDiv.appendChild(item);
      });

    } else {
      showStep('.step-4');
      loadStep4Dates(service);
    }

  } catch (error) {
    console.error('Lookup error:', error);
    document.getElementById('checkResult').innerText = 'Error checking bookings. Please try again.';
  }
});

document.getElementById('bookAnotherFrom3').addEventListener('click', function() {
  showStep('.step-4');
  const service = document.getElementById('selectedService').value;
  loadStep4Dates(service);
});

document.addEventListener('click', function(e) {
  if (e.target && e.target.classList.contains('edit-booking-btn')) {
    const service = e.target.getAttribute('data-service');
    const date = e.target.getAttribute('data-date');
    const time = e.target.getAttribute('data-time');
    const email = e.target.getAttribute('data-email');

    document.getElementById('step2_service').value = service;
    document.getElementById('selectedService').value = service;
    document.getElementById('selectedEmail').value = email;
    document.getElementById('selectedDate').value = date;
    document.getElementById('selectedTime').value = time;

    // Set editing flag
    document.getElementById('bookingForm').dataset.editing = 'true';

    showStep('.step-4');
    loadStep4Dates(service, date, time);
  }
});

function loadStep4Dates(service, preselectDate = null, preselectTime = null) {
  document.getElementById('step4_service').textContent = service;
  currentWeekStart = new Date();

  const loadingSpinner = document.getElementById('calendarLoading');
  loadingSpinner.style.display = 'flex';

  document.getElementById('calendarWeek').innerHTML = '';
  document.getElementById('timeSlots').innerHTML = '<p>Please select a date</p>';
  document.getElementById('selectedDate').value = '';
  document.getElementById('selectedTime').value = '';
  updateConfirmButtonState();

  loadAvailableDates(service).then(availableDates => {
    renderWeek(availableDates);
    loadingSpinner.style.display = 'none';

    if (preselectDate) {
      document.getElementById('selectedDate').value = preselectDate;

      const slots = availableDatesGlobal.find(d => d.date === preselectDate)?.slots || [];
      renderTimeSlots(slots);

      if (preselectTime) {
        setTimeout(() => {
          document.querySelectorAll('.slot').forEach(slotBtn => {
            if (slotBtn.textContent === preselectTime) {
              slotBtn.classList.add('selected');
              document.getElementById('selectedTime').value = preselectTime;
              updateConfirmButtonState();
            }
          });
        }, 300);
      }
    }
  });

  document.getElementById('prevWeek').onclick = () => {
    currentWeekStart.setDate(currentWeekStart.getDate() - 7);
    loadingSpinner.style.display = 'flex';
    loadAvailableDates(service).then(availableDates => {
      renderWeek(availableDates);
      loadingSpinner.style.display = 'none';
    });
  };

  document.getElementById('nextWeek').onclick = () => {
    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
    loadingSpinner.style.display = 'flex';
    loadAvailableDates(service).then(availableDates => {
      renderWeek(availableDates);
      loadingSpinner.style.display = 'none';
    });
  };

  document.getElementById('customDate').onchange = function() {
    document.getElementById('selectedDate').value = this.value;
    document.querySelectorAll('.day-card').forEach(el => el.classList.remove('selected'));

    const slots = availableDatesGlobal.find(d => d.date === this.value)?.slots || [];
    renderTimeSlots(slots);
    updateConfirmButtonState();
  };

  const toggleSwitch = document.getElementById('toggleCustomDateSwitch');
  const toggleLabel = document.getElementById('toggleLabel');
  const calendarSection = document.querySelector('.date-nav');
  const customDateSection = document.querySelector('.custom-date');

  toggleSwitch.checked = false;
  customDateSection.style.display = 'none';
  calendarSection.style.display = 'flex';

  toggleSwitch.onchange = () => {
    if (toggleSwitch.checked) {
      customDateSection.style.display = 'block';
      calendarSection.style.display = 'none';
      toggleLabel.textContent = 'Back to Week View';
    } else {
      customDateSection.style.display = 'none';
      calendarSection.style.display = 'flex';
      toggleLabel.textContent = 'Choose Custom Date';
    }
  };
}

document.getElementById('bookingForm').addEventListener('submit', async function(e) {
  e.preventDefault();

  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);

  // Add action = 'update' or 'new'
  data.action = document.getElementById('bookingForm').dataset.editing === 'true' ? 'update' : 'new';

  try {
    const response = await fetch(BOOKING_API, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    showStep('.step-5');

    // Clear editing flag after submit
    document.getElementById('bookingForm').dataset.editing = '';

  } catch (error) {
    console.error('Booking error:', error);
    document.getElementById('bookingResult').innerText = 'Error submitting booking. Please try again later.';
  }
});

document.getElementById('backToStep2').addEventListener('click', function() {
  showStep('.step-2');
});

document.getElementById('bookAnotherFrom5').addEventListener('click', function() {
  showStep('.step-1');
});

document.querySelector('.step-2 .back-btn').addEventListener('click', function() {
  showStep('.step-1');
});

document.querySelector('.step-4 .back-btn').addEventListener('click', function() {
  showStep('.step-2');
});

function updateConfirmButtonState() {
  const dateSelected = document.getElementById('selectedDate').value;
  const timeSelected = document.getElementById('selectedTime').value;
  const confirmButton = document.getElementById('confirmBookingBtn');

  if (dateSelected && timeSelected) {
    confirmButton.disabled = false;
  } else {
    confirmButton.disabled = true;
  }
}

}); // DOMContentLoaded


</script>





</body>
</html>
